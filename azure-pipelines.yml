trigger: none
pr:
  branches:
    include:
    - master

schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight (UTC) RichNav indexer run
  branches:
    include:
    - master

jobs:
- job: RichCodeNav_Indexing
  pool:
    name: Hosted Windows 2019 with VS2019
  variables:
    EnableRichCodeNavigation: true
  timeoutInMinutes: 200

  steps:
    - script: eng/cibuild.cmd -configuration Debug -prepareMachine
      displayName: Build
      
    - powershell: Write-Host $env:DOTNET_ROOT
      displayName: Display dotnet root
      env: 
        DOTNET_ROOT: $(Build.SourcesDirectory)/.dotnet

    - task: UseDotNet@2
      displayName: Install .NET CLI
      inputs:
        version: 2.2.100
    - script: dotnet --info
      displayName: Show .NET SDK info

    - task: RichCodeNavIndexer@0
      displayName: RichCodeNav Upload
      inputs:
        languages: 'csharp'
        environment: production
        richNavLogOutputDirectory: $(Build.SourcesDirectory)/artifacts/bin
      continueOnError: true
      env:
        DOTNET_ROOT: $(Build.SourcesDirectory)/.dotnet